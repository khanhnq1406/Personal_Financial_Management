version: v1
plugins:
  # Go gRPC plugin
  - plugin: buf.build/grpc/go:v1.3.0
    out: ../src/go-backend
    opt:
      - paths=source_relative

  # Go code generation plugin
  - plugin: buf.build/protocolbuffers/go:v1.31.0
    out: ../src/go-backend
    opt:
      - paths=source_relative

  # gRPC-Gateway plugin (generates REST reverse proxy .gw.go files)
  - plugin: buf.build/grpc-ecosystem/gateway:v2.27.4
    out: ../src/go-backend
    opt:
      - paths=source_relative
      - generate_unbound_methods=true

  # TypeScript plugin (ts-proto) for types only (no gRPC - for Vercel/REST)
  - plugin: buf.build/community/stephenh-ts-proto
    out: ../src/wj-client/gen
    opt:
      - outputServices=false
      - outputClientMethods=false
      - useExactTypes=false
      - lowerCaseServiceMethods=true
      - unnestEnumValue=true
      - enumsAsLiterals=true
      - stringEnums=true
      - esModuleInterop=true
      - forceLong=number
      - useOptionals=none
      - initializeFieldsAsOptional=true
      - oneof=unions
